import{a as Fe}from"./chunk-4CHRFDOQ.js";import{a as S}from"./chunk-ODFKUGYG.js";import{A as me,B as le,F as ue,G as pe,H as ce,I as de,J as fe,K as he,L as ge,M as ve,N as Ce,O as _e,P as be,Q as Ee,R as T,S as xe,T as Se,U as we,V as ye,W as De,X as Ie,Y as Ue,Z as Me,a as J,b as F,e as K,f as X,k as Y,l as d,m as Z,n as ee,o as te,p as ie,q as re,r as oe,s as ae,x as ne,y as se}from"./chunk-JJW7TMR6.js";import{a as Q,l as j}from"./chunk-UDCYXUZB.js";import"./chunk-IX6G3U3V.js";import{Cb as a,Db as n,E as C,Eb as p,Fb as _,Gb as b,Ib as q,Kc as z,Lb as E,Lc as G,Nb as x,Nc as W,Rb as B,Sb as L,Tb as P,Vb as s,W as g,Wb as w,Xb as h,Za as m,_a as f,_b as H,aa as A,ba as I,fa as N,j as D,ka as U,la as M,q as V,rb as c,ta as $,tb as u,ua as k}from"./chunk-WSLSRKTI.js";var O=(()=>{let t=class t{constructor(i,r){this.snackBar=i,this.http=r}listarUsuarios(){return this.http.get(`${S.API_URL}/usuarios`,{headers:{requireToken:"true"}}).pipe(C(i=>this.handlerError(i)))}listarRoles(){return this.http.get(`${S.API_URL}/general/roles`,{headers:{requireToken:"true"}}).pipe(C(i=>this.handlerError(i)))}insertarUsuario(i){return this.http.post(`${S.API_URL}/usuarios`,i,{headers:{requireToken:"true"}}).pipe(C(r=>this.handlerError(r)))}actualizarUsuario(i){return this.http.put(`${S.API_URL}/usuarios`,i,{headers:{requireToken:"true"}}).pipe(C(r=>this.handlerError(r)))}eliminarUsuario(i){return this.http.delete(`${S.API_URL}/usuarios/${i}`,{headers:{requireToken:"true"}}).pipe(C(r=>this.handlerError(r)))}handlerError(i){console.log(i);var r="Ocurri\xF3 un error";return i.error&&(i.error.message?r=i.error.message:r="Ocurri\xF3 un error"),this.snackBar.open(r,"",{duration:3e3}),V(()=>new Error(r))}};t.\u0275fac=function(r){return new(r||t)(N(K),N(Q))},t.\u0275prov=A({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Ve(e,t){if(e&1&&(a(0,"mat-option",14),s(1),n()),e&2){let l=t.$implicit;u("value",l.cveRol),m(),h(" ",l.descripcion+" - "+l.clave," ")}}function Ae(e,t){if(e&1&&(a(0,"mat-form-field",2)(1,"mat-label"),s(2,"Contrase\xF1a"),n(),p(3,"input",15),a(4,"mat-error"),s(5),n()()),e&2){let l=x();m(5),h(" ",l.baseForm.getErrorMessage(l.userForm.get("password"))," ")}}function qe(e,t){if(e&1&&(a(0,"mat-form-field",2)(1,"mat-label"),s(2,"Repetir Contrase\xF1a"),n(),p(3,"input",16),a(4,"mat-error"),s(5),n()()),e&2){let l=x();m(5),h(" ",l.baseForm.getErrorMessage(l.userForm.get("confirmPassword"))," ")}}var y=function(e){return e.EDIT="edit",e.NEW="new",e}(y||{}),Re=(()=>{let t=class t{constructor(i,r,o,v,$e){this.data=i,this.dialogRef=r,this.fb=o,this.baseForm=v,this.usuarioSvc=$e,this.destroy$=new D,this.titleButton="Guardar",this.actionTODO=y.NEW,this.roles=[],this.userForm=this.fb.group({cveUsuario:[""],nombre:["",[d.required,d.minLength(3)]],apellidos:["",[d.required,d.minLength(3)]],username:["",[d.required,d.minLength(3)]],cveRol:["",[d.required]],password:["",[d.required]],confirmPassword:["",[d.required]]})}ngOnInit(){this.usuarioSvc.listarRoles().pipe(g(this.destroy$)).subscribe(i=>{this.roles=i,this.pathData()})}pathData(){this.data.user.cveUsuario?(this.userForm.patchValue({cveUsuario:this.data?.user.cveUsuario,nombre:this.data?.user.nombre,apellidos:this.data?.user.apellidos,username:this.data?.user.username,cveRol:this.data?.user.cveRol}),this.userForm.get("username")?.disable(),this.userForm.get("password")?.setValidators(null),this.userForm.get("password")?.setErrors(null),this.userForm.get("confirmPassword")?.setValidators(null),this.userForm.get("confirmPassword")?.setErrors(null),this.userForm.updateValueAndValidity(),this.titleButton="Actualizar",this.actionTODO=y.EDIT):(this.titleButton="Guardar",this.actionTODO=y.NEW)}onSave(){if(this.userForm.invalid)return;let i=this.userForm.getRawValue();if(this.actionTODO===y.NEW){let r={nombre:i.nombre,apellidos:i.apellidos,username:i.username,password:i.password,cveRol:parseInt(i.cveRol)};this.usuarioSvc.insertarUsuario(r).pipe(g(this.destroy$)).subscribe({next:o=>{this.dialogRef.close(o)},error:o=>{console.error("Error al insertar usuario:",o)}})}else{let r={cveUsuario:parseInt(i.cveUsuario),nombre:i.nombre,apellidos:i.apellidos,cveRol:parseInt(i.cveRol)};this.usuarioSvc.actualizarUsuario(r).pipe(g(this.destroy$)).subscribe({next:o=>{this.dialogRef.close(o)},error:o=>{console.error("Error al actualizar usuario:",o)}})}}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};t.\u0275fac=function(r){return new(r||t)(f(Se),f(xe),f(oe),f(Fe),f(O))},t.\u0275cmp=U({type:t,selectors:[["app-usuario-dialog"]],decls:39,vars:9,consts:[["mat-dialog-title",""],[3,"submit","formGroup"],["appearance","outline",1,"full-width"],["type","text","formControlName","nombre","matInput",""],["type","text","formControlName","apellidos","matInput",""],["type","text","formControlName","username","matInput",""],["formControlName","cveRol"],[3,"value",4,"ngFor","ngForOf"],["class","full-width","appearance","outline",4,"ngIf"],["align","center"],["type","button","mat-flat-button","","color","warn",1,"me-2"],["type","submit","mat-flat-button","","color","primary"],["align","end"],["mat-button","","mat-dialog-close",""],[3,"value"],["type","password","formControlName","password","matInput",""],["type","password","formControlName","confirmPassword","matInput",""]],template:function(r,o){r&1&&(a(0,"h1",0),s(1,"Usuario"),n(),a(2,"mat-dialog-content")(3,"form",1),E("submit",function(){return o.onSave()}),a(4,"mat-form-field",2)(5,"mat-label"),s(6,"Nombre"),n(),p(7,"input",3),a(8,"mat-error"),s(9),n()(),a(10,"mat-form-field",2)(11,"mat-label"),s(12,"Apellidos"),n(),p(13,"input",4),a(14,"mat-error"),s(15),n()(),a(16,"mat-form-field",2)(17,"mat-label"),s(18,"Nombre de Usuario"),n(),p(19,"input",5),a(20,"mat-error"),s(21),n()(),a(22,"mat-form-field",2)(23,"mat-label"),s(24,"Rol(es)"),n(),a(25,"mat-select",6),c(26,Ve,2,2,"mat-option",7),n(),a(27,"mat-error"),s(28),n()(),c(29,Ae,6,1,"mat-form-field",8)(30,qe,6,1,"mat-form-field",8),a(31,"div",9)(32,"button",10),s(33," Limpiar "),n(),a(34,"button",11),s(35),n()()()(),a(36,"mat-dialog-actions",12)(37,"button",13),s(38," Cerrar "),n()()),r&2&&(m(3),u("formGroup",o.userForm),m(6),h(" ",o.baseForm.getErrorMessage(o.userForm.get("nombre"))," "),m(6),h(" ",o.baseForm.getErrorMessage(o.userForm.get("apellidos"))," "),m(6),h(" ",o.baseForm.getErrorMessage(o.userForm.get("username"))," "),m(5),u("ngForOf",o.roles),m(2),h(" ",o.baseForm.getErrorMessage(o.userForm.get("cveRol"))," "),m(),u("ngIf",o.actionTODO=="new"),m(),u("ngIf",o.actionTODO=="new"),m(5),h(" ",o.titleButton," "))},dependencies:[z,G,te,Y,Z,ee,ie,re,F,le,me,ne,se,ye,De,Ue,Ie,Ee,J]});let e=t;return e})();var Be=()=>[5,10,20,100];function Le(e,t){e&1&&(a(0,"th",16),s(1," Nombre "),n())}function Pe(e,t){if(e&1&&(a(0,"td",17),s(1),n()),e&2){let l=t.$implicit;m(),w(l.nombre)}}function He(e,t){e&1&&(a(0,"th",16),s(1," Apellidos "),n())}function ze(e,t){if(e&1&&(a(0,"td",17),s(1),n()),e&2){let l=t.$implicit;m(),w(l.apellidos)}}function Ge(e,t){e&1&&(a(0,"th",16),s(1," Nombre de Usuario "),n())}function We(e,t){if(e&1&&(a(0,"td",17),s(1),n()),e&2){let l=t.$implicit;m(),w(l.username)}}function Qe(e,t){e&1&&(a(0,"th",16),s(1," Rol(es) "),n())}function Je(e,t){if(e&1&&(a(0,"td",17),s(1),n()),e&2){let l=t.$implicit;m(),w(l.rol.descripcion)}}function Ke(e,t){e&1&&p(0,"th",16)}function Xe(e,t){if(e&1){let l=q();a(0,"td",18)(1,"button",19),E("click",function(){let r=$(l).$implicit,o=x();return k(o.onOpenModal(r))}),a(2,"mat-icon"),s(3,"edit"),n(),s(4," Editar "),n(),a(5,"button",20),E("click",function(){let r=$(l).$implicit,o=x();return k(o.onDelete(r.cveUsuario))}),a(6,"mat-icon"),s(7,"delete"),n(),s(8," Eliminar "),n()()}}function Ye(e,t){e&1&&p(0,"tr",21)}function Ze(e,t){e&1&&p(0,"tr",22)}var Oe=(()=>{let t=class t{constructor(i,r){this.dialog=i,this.usuarioSvc=r,this.destroy$=new D,this.dataSource=new be,this.displayedColumns=["nombre","apellidos","username","rol","acciones"]}ngOnInit(){this.listar()}listar(){this.usuarioSvc.listarUsuarios().pipe(g(this.destroy$)).subscribe(i=>{this.dataSource.data=i})}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onOpenModal(i={}){this.dialog.open(Re,{maxWidth:"100%",width:"80%",data:{user:i}}).afterClosed().pipe(g(this.destroy$)).subscribe(o=>{o&&this.listar()})}onDelete(i){this.usuarioSvc.eliminarUsuario(i).pipe(g(this.destroy$)).subscribe(r=>{this.listar()})}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};t.\u0275fac=function(r){return new(r||t)(f(we),f(O))},t.\u0275cmp=U({type:t,selectors:[["app-usuarios"]],viewQuery:function(r,o){if(r&1&&B(T,5),r&2){let v;L(v=P())&&(o.paginator=v.first)}},decls:27,vars:5,consts:[[1,"m-3"],["align","right"],["mat-flat-button","","color","primary",1,"m-2",3,"click"],[1,"table-content","mat-elevation-z8","m-4"],["mat-table","",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","apellidos"],["matColumnDef","username"],["matColumnDef","rol"],["matColumnDef","acciones"],["mat-cell","","class","text-center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"text-center"],["mat-flat-button","","color","accent",1,"me-2",3,"click"],["mat-flat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(r,o){r&1&&(a(0,"h3",0),s(1,"Usuarios"),n(),a(2,"div",1)(3,"button",2),E("click",function(){return o.onOpenModal()}),a(4,"mat-icon"),s(5,"add"),n(),s(6," Agregar "),n()(),a(7,"div",3)(8,"table",4),_(9,5),c(10,Le,2,0,"th",6)(11,Pe,2,1,"td",7),b(),_(12,8),c(13,He,2,0,"th",6)(14,ze,2,1,"td",7),b(),_(15,9),c(16,Ge,2,0,"th",6)(17,We,2,1,"td",7),b(),_(18,10),c(19,Qe,2,0,"th",6)(20,Je,2,1,"td",7),b(),_(21,11),c(22,Ke,1,0,"th",6)(23,Xe,9,0,"td",12),b(),c(24,Ye,1,0,"tr",13)(25,Ze,1,0,"tr",14),n(),p(26,"mat-paginator",15),n()),r&2&&(m(8),u("dataSource",o.dataSource),m(16),u("matHeaderRowDef",o.displayedColumns),m(),u("matRowDefColumns",o.displayedColumns),m(),u("pageSizeOptions",H(4,Be)))},dependencies:[F,X,ue,ce,ge,de,pe,ve,fe,he,Ce,_e,T]});let e=t;return e})();var et=[{path:"",component:Oe}],Ne=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=M({type:t}),t.\u0275inj=I({imports:[j.forChild(et),j]});let e=t;return e})();var $t=(()=>{let t=class t{};t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=M({type:t}),t.\u0275inj=I({imports:[W,Ne,ae,Me]});let e=t;return e})();export{$t as UsuariosModule};
